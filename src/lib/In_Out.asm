
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;                              In_Out.asm
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
;                                                       Oscar, 2013
; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
global	Out_Byte
global	In_Byte
global  ReadPort
global	WritePort

; ========================================================================
;                  void Out_Byte(u16 port, u8 value);
; ========================================================================
Out_Byte:
	mov	edx, [esp + 4]		; port
	mov	al, [esp + 4 + 4]	; value
	out	dx, al
	nop	; 一点延迟
	nop
	ret

; ========================================================================
;                  u8 In_Byte(u16 port);
; ========================================================================
In_Byte:
	mov	edx, [esp + 4]		; port
	xor	eax, eax
	in	al, dx
	nop	; 一点延迟
	nop
	ret
; 返回值都存放在eax中

; ========================================================================
;                  void port_read(u16 port, void* buf, int n);
; ========================================================================
ReadPort:
	mov	edx, [esp + 4]		; port
	mov	edi, [esp + 4 + 4]	; buf
	mov	ecx, [esp + 4 + 4 + 4]	; n
	shr	ecx, 1
	cld
	rep	insw
	ret

; ========================================================================
;                  void port_write(u16 port, void* buf, int n);
; ========================================================================
WritePort:
	mov	edx, [esp + 4]		; port
	mov	esi, [esp + 4 + 4]	; buf
	mov	ecx, [esp + 4 + 4 + 4]	; n
	shr	ecx, 1
	cld
	rep	outsw
	ret